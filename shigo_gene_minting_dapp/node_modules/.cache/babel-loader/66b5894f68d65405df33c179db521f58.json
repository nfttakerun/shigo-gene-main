{"ast":null,"code":"import _toConsumableArray from \"/Users/takerun/Documents/shigo-gene-main/shigo_gene_minting_dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _createForOfIteratorHelper from \"/Users/takerun/Documents/shigo-gene-main/shigo_gene_minting_dapp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\n\n/**\n * MIT License\n *\n * Copyright (c) 2021 Andrew Raffensperger\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n * This is a near carbon-copy of the original source (link below) with the\n * TypeScript typings added and a few tweaks to make it ES3-compatible.\n *\n * See: https://github.com/adraffy/ens-normalize.js\n */\nimport { toUtf8CodePoints } from \"@ethersproject/strings\";\nimport { getData } from './include.js';\nvar r = getData();\nimport { read_member_array, read_mapped_map, read_emoji_trie } from './decoder.js'; // @TODO: This should be lazily loaded\n\nvar VALID = new Set(read_member_array(r));\nvar IGNORED = new Set(read_member_array(r));\nvar MAPPED = read_mapped_map(r);\nvar EMOJI_ROOT = read_emoji_trie(r); //const NFC_CHECK = new Set(read_member_array(r, Array.from(VALID.values()).sort((a, b) => a - b)));\n//const STOP = 0x2E;\n\nvar HYPHEN = 0x2D;\nvar UNDERSCORE = 0x5F;\n\nfunction explode_cp(name) {\n  return toUtf8CodePoints(name);\n}\n\nfunction filter_fe0f(cps) {\n  return cps.filter(function (cp) {\n    return cp != 0xFE0F;\n  });\n}\n\nexport function ens_normalize_post_check(name) {\n  var _iterator = _createForOfIteratorHelper(name.split('.')),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var label = _step.value;\n      var cps = explode_cp(label);\n\n      try {\n        for (var i = cps.lastIndexOf(UNDERSCORE) - 1; i >= 0; i--) {\n          if (cps[i] !== UNDERSCORE) {\n            throw new Error(\"underscore only allowed at start\");\n          }\n        }\n\n        if (cps.length >= 4 && cps.every(function (cp) {\n          return cp < 0x80;\n        }) && cps[2] === HYPHEN && cps[3] === HYPHEN) {\n          throw new Error(\"invalid label extension\");\n        }\n      } catch (err) {\n        throw new Error(\"Invalid label \\\"\".concat(label, \"\\\": \").concat(err.message));\n      }\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n\n  return name;\n}\nexport function ens_normalize(name) {\n  return ens_normalize_post_check(normalize(name, filter_fe0f));\n}\n\nfunction normalize(name, emoji_filter) {\n  var input = explode_cp(name).reverse(); // flip for pop\n\n  var output = [];\n\n  while (input.length) {\n    var emoji = consume_emoji_reversed(input);\n\n    if (emoji) {\n      output.push.apply(output, _toConsumableArray(emoji_filter(emoji)));\n      continue;\n    }\n\n    var cp = input.pop();\n\n    if (VALID.has(cp)) {\n      output.push(cp);\n      continue;\n    }\n\n    if (IGNORED.has(cp)) {\n      continue;\n    }\n\n    var cps = MAPPED[cp];\n\n    if (cps) {\n      output.push.apply(output, _toConsumableArray(cps));\n      continue;\n    }\n\n    throw new Error(\"Disallowed codepoint: 0x\".concat(cp.toString(16).toUpperCase()));\n  }\n\n  return ens_normalize_post_check(nfc(String.fromCodePoint.apply(String, output)));\n}\n\nfunction nfc(s) {\n  return s.normalize('NFC');\n}\n\nfunction consume_emoji_reversed(cps, eaten) {\n  var _a;\n\n  var node = EMOJI_ROOT;\n  var emoji;\n  var saved;\n  var stack = [];\n  var pos = cps.length;\n  if (eaten) eaten.length = 0; // clear input buffer (if needed)\n\n  var _loop = function _loop() {\n    var cp = cps[--pos];\n    node = (_a = node.branches.find(function (x) {\n      return x.set.has(cp);\n    })) === null || _a === void 0 ? void 0 : _a.node;\n    if (!node) return \"break\";\n\n    if (node.save) {\n      // remember\n      saved = cp;\n    } else if (node.check) {\n      // check exclusion\n      if (cp === saved) return \"break\";\n    }\n\n    stack.push(cp);\n\n    if (node.fe0f) {\n      stack.push(0xFE0F);\n      if (pos > 0 && cps[pos - 1] == 0xFE0F) pos--; // consume optional FE0F\n    }\n\n    if (node.valid) {\n      // this is a valid emoji (so far)\n      emoji = stack.slice(); // copy stack\n\n      if (node.valid == 2) emoji.splice(1, 1); // delete FE0F at position 1 (RGI ZWJ don't follow spec!)\n\n      if (eaten) eaten.push.apply(eaten, _toConsumableArray(cps.slice(pos).reverse())); // copy input (if needed)\n\n      cps.length = pos; // truncate\n    }\n  };\n\n  while (pos) {\n    var _ret = _loop();\n\n    if (_ret === \"break\") break;\n  }\n\n  return emoji;\n}","map":{"version":3,"mappings":"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","names":["toUtf8CodePoints","getData","r","read_member_array","read_mapped_map","read_emoji_trie","VALID","Set","IGNORED","MAPPED","EMOJI_ROOT","HYPHEN","UNDERSCORE","explode_cp","name","filter_fe0f","cps","filter","cp","ens_normalize_post_check","split","label","i","lastIndexOf","Error","length","every","err","message","ens_normalize","normalize","emoji_filter","input","reverse","output","emoji","consume_emoji_reversed","push","pop","has","toString","toUpperCase","nfc","String","fromCodePoint","s","eaten","node","saved","stack","pos","branches","find","x","set","_a","save","check","fe0f","valid","slice","splice"],"sourceRoot":"","sources":["../../src.ts/ens-normalize/lib.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}